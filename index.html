<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Ankerrechner Binnenschiff (Bug / Heck)</title>
  <style>
    :root {
      --bg: #0b1020;
      --card-bg: #151a2c;
      --accent: #4da3ff;
      --accent-soft: rgba(77,163,255,0.15);
      --text: #f7f7ff;
      --muted: #b3b9d4;
      --danger: #ff7070;
      --border: #262c44;
    }
    * {
      box-sizing: border-box;
      font-family: system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;
    }
    body {
      margin: 0;
      padding: 16px;
      background: radial-gradient(circle at top,#1f2c4d,#050816);
      color: var(--text);
      display: flex;
      justify-content: center;
    }
    .app {
      width: 100%;
      max-width: 480px;
      background: linear-gradient(145deg,#14192a,#0b0f1c);
      border-radius: 16px;
      padding: 16px 16px 20px;
      border: 1px solid var(--border);
      box-shadow: 0 24px 50px rgba(0,0,0,0.6);
    }
    header { margin-bottom: 16px; }
    header h1 {
      font-size: 1.25rem;
      margin: 0 0 4px;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    header h1 span.icon {
      width: 26px; height: 26px;
      border-radius: 8px;
      background: radial-gradient(circle at 30% 30%,#fff,#4da3ff);
      display: inline-flex;
      align-items: center;
      justify-content: center;
      font-size: 16px;
      color: #050816;
      box-shadow: 0 0 12px rgba(77,163,255,0.8);
    }
    header p { margin: 0; font-size: .8rem; color: var(--muted); }
    .badge-row {
      margin-top: 8px;
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
    }
    .badge {
      font-size: .7rem;
      padding: 3px 8px;
      border-radius: 999px;
      border: 1px solid var(--border);
      color: var(--muted);
      background: rgba(11,16,32,.85);
    }
    .badge.accent {
      border-color: var(--accent-soft);
      background: var(--accent-soft);
      color: var(--accent);
    }
    .info {
      font-size: .7rem;
      color: var(--muted);
      margin-bottom: 10px;
      padding: 8px 10px;
      border-radius: 10px;
      background: rgba(16,24,48,.9);
      border: 1px dashed rgba(119,136,187,.7);
    }
    .info strong { color: var(--accent); }
    form { display:flex; flex-direction:column; gap:12px; }
    .section {
      border-radius: 12px;
      padding: 10px 10px 6px;
      background: rgba(9,13,30,.95);
      border: 1px solid var(--border);
    }
    .section-title {
      font-size: .8rem;
      font-weight: 600;
      margin-bottom: 8px;
      display:flex;
      justify-content:space-between;
      align-items:center;
      color: var(--muted);
    }
    .section-title .label {
      text-transform: uppercase;
      letter-spacing: .08em;
      font-size: .7rem;
      color: var(--accent);
    }
    .section-title .small { font-size:.7rem; }
    .grid-2 {
      display:grid;
      grid-template-columns:1fr 1fr;
      gap:8px;
    }
    .field { margin-bottom: 6px; }
    label {
      display:flex;
      justify-content:space-between;
      align-items:baseline;
      font-size:.78rem;
      margin-bottom:2px;
      color:var(--text);
    }
    label .unit {
      font-size:.7rem;
      color:var(--muted);
      margin-left:6px;
    }
    label .req {
      color:var(--danger);
      margin-left:4px;
      font-size:.8em;
    }
    input, select {
      width:100%;
      padding:6px 8px;
      border-radius:8px;
      border:1px solid var(--border);
      background:rgba(3,6,20,.95);
      color:var(--text);
      font-size:.85rem;
      outline:none;
    }
    input:focus, select:focus {
      border-color:var(--accent);
      box-shadow:0 0 0 1px rgba(77,163,255,.6);
    }
    input.error, select.error {
      border-color:var(--danger);
      box-shadow:0 0 0 1px rgba(255,112,112,.5);
    }
    .hint {
      font-size:.7rem;
      color:var(--muted);
      margin-top:1px;
    }
    .error-text {
      font-size:.7rem;
      color:var(--danger);
      margin-top:2px;
    }
    .slider-row {
      display:flex;
      align-items:center;
      gap:8px;
    }
    .slider-row input[type="range"] { flex:1; }
    .slider-value {
      min-width:42px;
      text-align:right;
      font-size:.78rem;
      color:var(--accent);
    }
    input[type="range"] {
      -webkit-appearance:none;
      appearance:none;
      height:4px;
      border-radius:999px;
      background:#252b43;
      outline:none;
    }
    input[type="range"]::-webkit-slider-thumb {
      -webkit-appearance:none;
      appearance:none;
      width:16px; height:16px;
      border-radius:50%;
      background:var(--accent);
      border:2px solid #fff;
      box-shadow:0 0 10px rgba(77,163,255,.9);
      cursor:pointer;
    }
    input[type="range"]::-moz-range-thumb{
      width:16px; height:16px;
      border-radius:50%;
      background:var(--accent);
      border:2px solid #fff;
      box-shadow:0 0 10px rgba(77,163,255,.9);
      cursor:pointer;
    }
    button {
      margin-top:4px;
      width:100%;
      padding:10px;
      border-radius:999px;
      border:none;
      background:linear-gradient(135deg,#4da3ff,#7b5cff);
      color:#050816;
      font-weight:600;
      font-size:.9rem;
      cursor:pointer;
      box-shadow:0 12px 25px rgba(0,0,0,.7);
    }
    button:active {
      transform:translateY(1px);
      box-shadow:0 8px 18px rgba(0,0,0,.7);
    }
    .results {
      margin-top:14px;
      border-radius:12px;
      padding:10px;
      background:radial-gradient(circle at top left,#26345b,#070a18);
      border:1px solid var(--border);
    }
    .results h2{
      font-size:.9rem;
      margin:0 0 6px;
      display:flex;
      justify-content:space-between;
      align-items:center;
    }
    .results h2 span{
      font-size:.7rem;
      color:var(--muted);
      font-weight:400;
    }
    .results-row{
      display:flex;
      justify-content:space-between;
      font-size:.8rem;
      margin-top:4px;
    }
    .results-row .label{color:var(--muted);}
    .results-row .value{font-weight:600;}
    .results-small{
      margin-top:8px;
      font-size:.7rem;
      color:var(--muted);
    }
    .results-small code{
      font-size:.68rem;
      background:rgba(4,7,20,.9);
      padding:2px 4px;
      border-radius:4px;
      border:1px solid #28304c;
    }
    .footer{
      margin-top:10px;
      font-size:.65rem;
      color:var(--muted);
      line-height:1.4;
    }
    .footer strong{color:var(--accent);}
    @media (max-width:380px){
      .app{padding:12px 10px 16px;}
      header h1{font-size:1.1rem;}
      .grid-2{grid-template-columns:1fr;}
    }
  </style>
</head>
<body>
  <div class="app">
    <header>
      <h1>
        <span class="icon">⚓</span>
        Ankerrechner Binnenschiff
      </h1>
      <p>Vereinfachte Abschätzung für Bug- und Heckanker nach ES-TRIN-Logik.</p>
      <div class="badge-row">
        <span class="badge accent">Demo-Tool · keine amtliche Berechnung</span>
        <span class="badge">Mobile optimiert</span>
      </div>
    </header>

    <div class="info">
      <strong>Hinweis:</strong> Dieses Tool bildet die Formelstruktur aus ES-TRIN vereinfacht ab.
      Es ersetzt <strong>nicht</strong> die Prüfung im Einzelfall, Klassifikationsregeln oder
      nationale Vorschriften. Für verbindliche Auslegungen sind die offiziellen Regelwerke maßgeblich.
      Kettenlängen sind hier auf 60&nbsp;m (Kette) bzw. 70&nbsp;m (Draht) begrenzt.
    </div>

    <form id="calcForm" novalidate>
      <!-- Schiffsdaten -->
      <div class="section">
        <div class="section-title">
          <span class="label">Schiffsdaten</span>
          <span class="small">* Pflichtfelder</span>
        </div>

        <div class="field">
          <label for="vesselType">
            Schiffstyp
            <span class="req">*</span>
          </label>
          <select id="vesselType" required>
            <option value="">Bitte wählen …</option>
            <option value="gms">Gütermotorschiff / TMS</option>
            <option value="leichter">Leichter</option>
            <option value="fahrgast">Fahrgastschiff</option>
            <option value="schub">Schubboot / Schubverband</option>
            <option value="sonst">Sonstiges Binnenschiff</option>
          </select>
          <div class="hint">
            Güterschiffe: Bemessung über Tragfähigkeit; Fahrgastschiffe: über Verdrängung.
          </div>
          <div class="error-text" data-error-for="vesselType"></div>
        </div>

        <div class="grid-2">
          <div class="field">
            <label for="length">
              Länge L
              <span class="unit">m</span>
              <span class="req">*</span>
            </label>
            <input type="number" id="length" min="1" step="0.1" required />
            <div class="hint">Länge laut Schiffszeugnis.</div>
            <div class="error-text" data-error-for="length"></div>
          </div>
          <div class="field">
            <label for="breadth">
              Breite B
              <span class="unit">m</span>
              <span class="req">*</span>
            </label>
            <input type="number" id="breadth" min="1" step="0.1" required />
            <div class="hint">Größte Breite.</div>
            <div class="error-text" data-error-for="breadth"></div>
          </div>
        </div>

        <div class="grid-2">
          <div class="field">
            <label for="draught">
              Tiefgang T
              <span class="unit">m</span>
              <span class="req">*</span>
            </label>
            <input type="number" id="draught" min="0.1" step="0.1" required />
            <div class="hint">Bemessungstiefgang.</div>
            <div class="error-text" data-error-for="draught"></div>
          </div>
          <div class="field">
            <label for="capacity">
              Tragfähigkeit / Verdrängung
              <span class="unit">t bzw. m³</span>
              <span class="req">*</span>
            </label>
            <input type="number" id="capacity" min="1" step="1" required />
            <div class="hint">
              Güterschiffe: Deadweight in t. Fahrgastschiffe: Verdrängung in m³ (laut Zeugnis).
            </div>
            <div class="error-text" data-error-for="capacity"></div>
          </div>
        </div>

        <div class="field">
          <label for="windArea">
            Windangriffsfläche A<sub>f</sub>
            <span class="unit">m²</span>
          </label>
          <input type="number" id="windArea" min="0" step="1" />
          <div class="hint">
            Optional. Für Fahrgastschiffe kann P = k·B·T + 4·A<sub>f</sub> verwendet werden.
          </div>
        </div>

        <div class="field">
          <label>
            <span>Windflächenformel anwenden (nur Fahrgastschiff)</span>
            <input type="checkbox" id="useWindFormula" style="margin-left:8px; width:auto;" />
          </label>
          <div class="hint">
            Wenn aktiviert und A<sub>f</sub> &gt; 0 eingetragen ist, wird P = k·B·T + 4·A<sub>f</sub> verwendet.
          </div>
        </div>
      </div>

      <!-- Auslegungsparameter -->
      <div class="section">
        <div class="section-title">
          <span class="label">Auslegungsparameter</span>
        </div>

        <div class="field">
          <label for="safetyFactor">
            Sicherheitsfaktor
            <span class="req">*</span>
          </label>
          <div class="slider-row">
            <input
              type="range"
              id="safetyFactor"
              min="1.0"
              max="1.5"
              step="0.05"
              value="1.20"
            />
            <span class="slider-value" id="safetyFactorValue">1.20</span>
          </div>
          <div class="hint">
            Multipliziert das berechnete P. Konservative Auslegung → höherer Faktor.
          </div>
        </div>

        <div class="field">
          <label for="connectionType">
            Verbindung Anker / Schiff
            <span class="req">*</span>
          </label>
          <select id="connectionType" required>
            <option value="">Bitte wählen …</option>
            <option value="kette">Kette (max. 60 m je Anker)</option>
            <option value="draht">Drahtseil (1,2 × Kettenrichtwert, max. 70 m)</option>
          </select>
          <div class="hint">
            Draht: Richtlänge = 1,2 × Kettenrichtwert, jedoch technisch auf 70 m begrenzt.
          </div>
          <div class="error-text" data-error-for="connectionType"></div>
        </div>

        <div class="grid-2">
          <div class="field">
            <label for="bowCount">
              Anzahl Buganker
              <span class="req">*</span>
            </label>
            <input type="number" id="bowCount" min="1" max="2" step="1" value="2" />
            <div class="hint">Üblich sind 2 Buganker.</div>
          </div>
          <div class="field">
            <label for="sternCount">
              Anzahl Heckanker
              <span class="req">*</span>
            </label>
            <input type="number" id="sternCount" min="0" max="2" step="1" value="1" />
            <div class="hint">Heckanker je nach Schiff / Revier.</div>
          </div>
        </div>

        <div class="field">
          <label>
            <span>Heckanker zum Stoppen gegen Strömung erforderlich (Bug zu Tal)?</span>
            <input type="checkbox" id="sternStop" style="margin-left:8px; width:auto;" />
          </label>
          <div class="hint">
            Wenn aktiviert, wird ein höherer Richtwert für die Heckanker-Länge angesetzt (z.B. 60 m Kette).
          </div>
        </div>
      </div>

      <button type="submit">Berechnung durchführen</button>
    </form>

    <div class="results" id="results" style="display:none;">
      <h2>
        Ergebnisse (vereinfacht)
        <span id="resultScope"></span>
      </h2>

      <div class="results-row">
        <span class="label">Buganker gesamt P</span>
        <span class="value" id="resBowTotal">–</span>
      </div>
      <div class="results-row">
        <span class="label">Heckanker gesamt</span>
        <span class="value" id="resSternTotal">–</span>
      </div>
      <div class="results-row">
        <span class="label">Gesamtmasse Anker (Bug + Heck)</span>
        <span class="value" id="resAllTotal">–</span>
      </div>

      <div class="results-row">
        <span class="label">Masse je Buganker (≈)</span>
        <span class="value" id="resBowPer">–</span>
      </div>
      <div class="results-row">
        <span class="label">Masse je Heckanker (≈)</span>
        <span class="value" id="resSternPer">–</span>
      </div>

      <div class="results-row">
        <span class="label">Länge je Bugkette / -draht (Richtwert)</span>
        <span class="value" id="resBowChain">–</span>
      </div>
      <div class="results-row">
        <span class="label">Länge je Heckkette / -draht (Richtwert)</span>
        <span class="value" id="resSternChain">–</span>
      </div>

      <div class="results-row">
        <span class="label">Mindestbruchlast je Bugkette / -draht</span>
        <span class="value" id="resBowBreak">–</span>
      </div>
      <div class="results-row">
        <span class="label">Mindestbruchlast je Heckkette / -draht</span>
        <span class="value" id="resSternBreak">–</span>
      </div>

      <div class="results-small">
        Formelgrundlagen (vereinfacht):<br />
        <code>P = k · B · T · Sicherheitsfaktor</code>, mit
        <code>k = c · √(L / (8 · B))</code> (Leichter: <code>k = c</code>).<br />
        <code>c</code> abhängig von Tragfähigkeit/Verdrängung (45 / 55 / 65 / 70).<br />
        Heckanker: 25&nbsp;% bzw. 50&nbsp;% von P (≤ 86&nbsp;m / &gt; 86&nbsp;m).<br />
        Richtlängen: Kette max. 60&nbsp;m je Anker, Draht (1,2 × Richtwert) max. 70&nbsp;m.<br />
        Mindestbruchlast je Kette/Draht aus Ankergewicht nach ES-TRIN-Formel (vereinfacht).
      </div>
    </div>

    <div class="footer">
      <strong>Disclaimer:</strong> Dieses Tool dient der überschlägigen technischen Abschätzung und
      internen Dokumentation. Es erhebt keinen Anspruch auf Vollständigkeit oder Konformität im
      Einzelfall. Maßgeblich sind ausschließlich ES-TRIN, nationale Vorschriften und ggf.
      Vorgaben der Klassifikationsgesellschaften.
    </div>
  </div>

  <script>
    (function () {
      const form = document.getElementById("calcForm");

      const vesselType = document.getElementById("vesselType");
      const lengthInput = document.getElementById("length");
      const breadthInput = document.getElementById("breadth");
      const draughtInput = document.getElementById("draught");
      const capacityInput = document.getElementById("capacity");
      const windAreaInput = document.getElementById("windArea");
      const useWindFormulaInput = document.getElementById("useWindFormula");
      const safetyFactorInput = document.getElementById("safetyFactor");
      const safetyFactorValue = document.getElementById("safetyFactorValue");
      const connectionType = document.getElementById("connectionType");
      const bowCountInput = document.getElementById("bowCount");
      const sternCountInput = document.getElementById("sternCount");
      const sternStopInput = document.getElementById("sternStop");

      const resultsBox = document.getElementById("results");
      const resultScope = document.getElementById("resultScope");
      const resBowTotal = document.getElementById("resBowTotal");
      const resSternTotal = document.getElementById("resSternTotal");
      const resAllTotal = document.getElementById("resAllTotal");
      const resBowPer = document.getElementById("resBowPer");
      const resSternPer = document.getElementById("resSternPer");
      const resBowChain = document.getElementById("resBowChain");
      const resSternChain = document.getElementById("resSternChain");
      const resBowBreak = document.getElementById("resBowBreak");
      const resSternBreak = document.getElementById("resSternBreak");

      safetyFactorInput.addEventListener("input", function () {
        safetyFactorValue.textContent = Number(this.value).toFixed(2);
      });

      function setError(input, message) {
        input.classList.add("error");
        const box = document.querySelector(
          '.error-text[data-error-for="' + input.id + '"]'
        );
        if (box) box.textContent = message || "";
      }

      function clearError(input) {
        input.classList.remove("error");
        const box = document.querySelector(
          '.error-text[data-error-for="' + input.id + '"]'
        );
        if (box) box.textContent = "";
      }

      function validateRequiredNumber(input, minValue) {
        clearError(input);
        const raw = input.value.trim();
        if (!raw) {
          setError(input, "Pflichtfeld – bitte ausfüllen.");
          return null;
        }
        const num = Number(raw.replace(",", "."));
        if (isNaN(num) || (typeof minValue === "number" && num < minValue)) {
          setError(
            input,
            "Ungültiger Wert – bitte Zahl " +
              (typeof minValue === "number" ? "≥ " + minValue : "") +
              " eingeben."
          );
          return null;
        }
        return num;
      }

      function validateSelect(input) {
        clearError(input);
        if (!input.value) {
          setError(input, "Bitte eine Auswahl treffen.");
          return null;
        }
        return input.value;
      }

      function getC(capacity) {
        if (capacity <= 400) return 45;
        if (capacity <= 650) return 55;
        if (capacity <= 1000) return 65;
        return 70;
      }

      // Richtwert Bugkette nach ES-TRIN-Logik:
      // <=40 m → 40 m, 40–50 m → L+10, >50 m → 60 m (hier ohnehin max. 60 m)
      function bugChainBase(L) {
        if (L <= 40) return 40;
        if (L <= 50) return L + 10;
        return 60;
      }

      // Heckkette: 40 m, bei Stoppen gegen Strömung 60 m (Richtwert)
      function sternChainBase(sternStop) {
        return sternStop ? 60 : 40;
      }

      // Mindestbruchlast nach vereinfachter ES-TRIN-Formel
      function breakingLoad(P_kg) {
        const P = P_kg;
        if (P <= 0 || !isFinite(P)) return 0;
        let R;
        if (P <= 500) {
          R = 0.35 * P;
        } else if (P <= 2000) {
          R = (0.35 - (P - 500) / 15000) * P;
        } else {
          R = 0.25 * P;
        }
        return R;
      }

      form.addEventListener("submit", function (e) {
        e.preventDefault();

        const vType = validateSelect(vesselType);
        const L = validateRequiredNumber(lengthInput, 1);
        const B = validateRequiredNumber(breadthInput, 1);
        const T = validateRequiredNumber(draughtInput, 0.1);
        const capacity = validateRequiredNumber(capacityInput, 1);
        const conn = validateSelect(connectionType);

        if (!vType || !L || !B || !T || !capacity || !conn) {
          resultsBox.style.display = "none";
          return;
        }

        const isPassenger = vType === "fahrgast";
        const isLighter = vType === "leichter";

        const AfRaw = windAreaInput.value.trim();
        const Af = AfRaw ? Number(AfRaw.replace(",", ".")) : 0;
        const useWind = isPassenger && useWindFormulaInput.checked && Af > 0;

        const sf = Number(safetyFactorInput.value);

        const c = getC(capacity);
        let k;
        if (isLighter) {
          k = c;
        } else {
          k = c * Math.sqrt(L / (8 * B));
        }

        let P = k * B * T; // kg
        if (useWind) {
          P = P + 4 * Af;
        }
        P = P * sf;

        // Heckanteil: 25 % bzw. 50 % von P
        const sternShare = L > 86 ? 0.5 : 0.25;
        const P_stern_total = P * sternShare;
        const P_all = P + P_stern_total;

        // Anzahl Anker
        let bowCount = Number(bowCountInput.value.replace(",", "."));
        let sternCount = Number(sternCountInput.value.replace(",", "."));
        if (!isFinite(bowCount) || bowCount < 1) bowCount = 1;
        if (!isFinite(sternCount) || sternCount < 0) sternCount = 0;

        const P_bow_per = P / bowCount;
        const P_stern_per = sternCount > 0 ? P_stern_total / sternCount : 0;

        // Basis-Richtlängen
        const baseBow = bugChainBase(L);
        const baseStern = sternChainBase(sternStopInput.checked);

        let bowLen = baseBow;
        let sternLen = baseStern;

        if (conn === "kette") {
          // Kette: max. 60 m je Anker
          bowLen = Math.min(baseBow, 60);
          sternLen = Math.min(baseStern, 60);
        } else if (conn === "draht") {
          // Draht: 1,2 × Kettenrichtwert, max. 70 m je Anker
          bowLen = Math.min(baseBow * 1.2, 70);
          sternLen = Math.min(baseStern * 1.2, 70);
        }

        // Mindestbruchlast je Ankerkette / -draht
        const R_bow = breakingLoad(P_bow_per);
        const R_stern = breakingLoad(P_stern_per);

        resBowTotal.textContent = P.toFixed(0) + " kg";
        resSternTotal.textContent = P_stern_total.toFixed(0) + " kg";
        resAllTotal.textContent = P_all.toFixed(0) + " kg";

        resBowPer.textContent = P_bow_per.toFixed(0) + " kg";
        resSternPer.textContent =
          sternCount > 0 ? P_stern_per.toFixed(0) + " kg" : "–";

        resBowChain.textContent =
          bowLen.toFixed(1) +
          " m " +
          (conn === "draht" ? "(Draht, begrenzt auf 70 m)" : "(Kette, begrenzt auf 60 m)");
        resSternChain.textContent =
          sternCount > 0
            ? sternLen.toFixed(1) +
              " m " +
              (conn === "draht"
                ? "(Draht, begrenzt auf 70 m)"
                : "(Kette, begrenzt auf 60 m)")
            : "–";

        resBowBreak.textContent =
          R_bow > 0 ? R_bow.toFixed(1) + " kN (je Bugkette/-draht)" : "–";
        resSternBreak.textContent =
          sternCount > 0 && R_stern > 0
            ? R_stern.toFixed(1) + " kN (je Heckkette/-draht)"
            : "–";

        let scopeText = "";
        if (isPassenger) scopeText = "Fahrgastschiff (vereinfacht)";
        else if (isLighter) scopeText = "Leichter (vereinfacht)";
        else scopeText = "Güter-/Binnenschiff (vereinfacht)";
        resultScope.textContent = scopeText;

        resultsBox.style.display = "block";
      });
    })();
  </script>
</body>
</html>